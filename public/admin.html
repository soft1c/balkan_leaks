<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Upload</title>
  <script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
</head>
<body>
  <form action="/admin/dodaj" method="post" enctype="multipart/form-data">
    <label for="ime">Ime:</label>
    <input type="text" name="ime" required>
    <br>
    
    <label for="prezime">Prezime:</label>
    <input type="text" name="prezime" required>
    <br>
  
    <label for="datumRodjenja">Datum rođenja:</label>
    <input type="date" name="datumRodjenja" required>
    <br>
  
    <label for="mjestoRodjenja">Mjesto rođenja:</label>
    <input type="text" name="mjestoRodjenja" required>
    <br>
  
    <label for="datumSmrti">Datum smrti:</label>
    <input type="date" name="datumSmrti">
    <br>
  
    <label for="slika">Slika osobe:</label>
    <input type="file" name="slika" accept="image/*" required>
    <br>
    <label for="opis">Opis:</label>
    <br>
    <textarea name="opis" id="opis"></textarea>

<script>
  ClassicEditor
    .create(document.querySelector('#opis'))
    .catch(error => {
      console.error(error);
    });
</script>
  
    <button type="submit">Dodaj osobu</button>
  </form>

  <h1>Upload Media</h1>

  <form id="uploadForm" enctype="multipart/form-data">
    <label for="licnost">Izaberite ličnost:</label>
    <select name="licnost" id="licnost" required>
      <!-- Ovde će biti dinamički dodate opcije sa nazivima ličnosti -->
    </select>
    <br>

    <label for="file">Izaberite fajl:</label>
    <input type="file" name="file" id="file" required>
    <br>

    <label for="type">Izaberite tip fajla:</label>
    <select name="type" id="type" required>
      <option value="image">Slika</option>
      <option value="video">Video</option>
      <option value="audio">Audio</option>
      <option value="text">Tekst</option>
    </select>
    <br>

    <button type="button" onclick="uploadMedia()">Upload</button>
  </form>
  <h2>IP Addresses and Login Times:</h2>
  <ul id="ipList"></ul>
  <script>
    function fetchUserIPs() {
      fetch('/user_ips')
        .then(response => response.json())
        .then(data => {
          const ipList = document.getElementById('ipList');
          ipList.innerHTML = ''; // Clear the existing list

          data.forEach(entry => {
            const listItem = document.createElement('li');
            listItem.textContent = `IP Address: ${entry.ip_address}, Login Time: ${entry.login_time}`;
            ipList.appendChild(listItem);
          });
        })
        .catch(error => console.error(error));
    }

    // Fetch IP addresses on page load
    fetchUserIPs();
  </script>

  <script>
    function uploadMedia() {
      const typeSelect = document.getElementById('type');
      const selectedType = typeSelect.value;
      const licnostSelect = document.getElementById('licnost');
      const selectedLicnost = licnostSelect.value;
      const uploadUrl = `/upload/${selectedType}`;

      const formData = new FormData(document.getElementById('uploadForm'));
      formData.append('licnost', selectedLicnost);

      fetch(uploadUrl, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log(data);
        dodajFajlUBazu(selectedLicnost, selectedType, data.filename);
      })
      .catch(error => {
        console.error(error);
      });
    }

    function dodajFajlUBazu(licnost, tipFajla, filePath) {
      console.log("Pokusava nesto");
      const uploadUrl = '/dodaj-fajl';
      const formData = new FormData();
      formData.append('licnost', licnost);
      formData.append('tipFajla', tipFajla);
      formData.append('file', filePath);
      console.log(formData);
      fetch(uploadUrl, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log(data);
        
      })
      .catch(error => {
        console.error(error);
      });
    }

    fetch('/ljudi')
      .then(response => response.json())
      .then(data => {
        const licnostSelect = document.getElementById('licnost');
        data.forEach(licnost => {
          const option = document.createElement('option');
          option.value = licnost.id; // Postavite vrednost opcije na ID ličnosti
          option.text = `${licnost.ime} ${licnost.prezime}`;
          licnostSelect.add(option);
        });
      })
      .catch(error => console.error(error));
  </script>
</body>
</html>
